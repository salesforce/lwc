name: Label Dependabot PRs

on:
    pull_request:
        types: [opened]

jobs:
    label:
        if: github.actor == 'dependabot[bot]'
        runs-on: ubuntu-latest
        permissions:
            pull-requests: write
        steps:
            - name: Add label if missing
              uses: actions/github-script@v7
              with:
                  script: |
                      const label = 'USER STORY';
                      const { data: labels } = await github.rest.issues.listLabelsOnIssue({
                        owner: context.repo.owner,
                        repo: context.repo.repo,
                        issue_number: context.issue.number,
                      });
                      if (!labels.some(l => l.name === label)) {
                        await github.rest.issues.addLabels({
                          owner: context.repo.owner,
                          repo: context.repo.repo,
                          issue_number: context.issue.number,
                          labels: [label],
                        });
                      }
